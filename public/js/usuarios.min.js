$(document).ready(function(){var a=$(".datatable").DataTable({ajax:{url:"../User/mostrar_usuarios",dataSrc:""},columns:[{data:"id"},{data:"usu_nombres"},{data:"usu_apellidos"},{data:"usu_email"},{data:"usu_telefono"},{data:"usu_celular"},{data:"usu_dni"},{data:"usu_fechaalta"},{data:"usu_usuario"},{data:"usu_acceso"},{defaultContent:"<button id='btn_editar' class='btn btn-info btn-sm' ><i class='fas fa-pencil-alt'></i></button>"},{defaultContent:"<button id='btn_eliminar' class='btn btn-danger btn-sm' onclick='eliminar_usuario()'><i class='far fa-trash-alt'></i></button>"},{defaultContent:"<button id='btn_editar_pass' class='btn btn-success btn-sm'><i class='fa fa-lock' aria-hidden='true'></i></button>"},],language:{url:"../public/fw/datatables/Spanish.json"},lengthMenu:[[10,15,20,-1],[10,15,20,"All"]]});
$(".datatable tbody").on("click","#btn_eliminar",function(){var d=a.row($(this).parents("tr")).data();if(d==undefined){var b=$(this).parents("tr");if(b.hasClass("child")){b=b.prev();
}var c=$(".datatable").DataTable().row(b).data();alertify.confirm('<i class="fa fa-bars" aria-hidden="true"></i> Eliminar',"¿Desea eliminar el usuario <strong>#"+c.id+"</strong>?",function(){eliminar_usuario(c.id);
alertify.notify("Se elimino el usuario <strong>#"+c.id+"</strong> correctamente.","custom-black",4,function(){});},function(){alertify.notify("Se cancelo la <strong>eliminación</strong>.","custom-black",4,function(){});
}).set("labels",{ok:"Eliminar",cancel:"Cancelar"});}else{alertify.confirm('<i class="fa fa-bars" aria-hidden="true"></i> Eliminar',"¿Desea eliminar el usuario <strong>#"+d.id+"</strong>?",function(){eliminar_usuario(d.id);
alertify.notify("Se elimino el usuario <strong>#"+d.id+"</strong> correctamente.","custom-black",4,function(){});},function(){alertify.notify("Se cancelo la <strong>eliminación</strong>.","custom-black",4,function(){});
}).set("labels",{ok:"Eliminar",cancel:"Cancelar"});}});$(".datatable tbody").on("click","#btn_editar",function(){var d=a.row($(this).parents("tr")).data();
if(d==undefined){var b=$(this).parents("tr");if(b.hasClass("child")){b=b.prev();}var c=$(".datatable").DataTable().row(b).data();editar_usuario(c.id);}else{editar_usuario(d.id);
}});$(".datatable tbody").on("click","#btn_editar_pass",function(){var d=a.row($(this).parents("tr")).data();if(d==undefined){var b=$(this).parents("tr");
if(b.hasClass("child")){b=b.prev();}var c=$(".datatable").DataTable().row(b).data();editar_password(c.id);$("#btn_editar_pass_modal").trigger("click");
}else{editar_password(d.id);$("#btn_editar_pass_modal").trigger("click");}});abrir_modal("modalusuario",'<i class="fa fa-bars" aria-hidden="true"></i> Modificar Usuario');
abrir_modal("modalpassword",'<i class="fa fa-bars" aria-hidden="true"></i> Modificar Contraseña');});function eliminar_usuario(a){$.ajax({url:"../User/eliminar_usuario",type:"POST",dataType:"html",data:{id:a,},success:function(b){table=$(".datatable").DataTable();
table.ajax.reload();}});}$(function(){$("#form_agregar_usuario").on("submit",function(g){g.preventDefault();var c=$(this);var b=c.attr("method");var a=c.attr("action");
var d=new FormData(this);d.append("dato","valor");$.ajax({url:a,type:b,dataType:"html",data:d,cache:false,contentType:false,processData:false,beforeSend:function(){$("#form_agregar_usuario .loading").show();
},success:function(e){$("#form_agregar_usuario .loading").hide();if(e==0){$("#form_agregar_usuario .form-control").each(function(){if($(this).val()==""){$(this).css({"box-shadow":" 0 0 0 0.2rem rgba(0,123,255,0.25)"});
}else{$(this).css({"box-shadow":" 0 0 0 0.2rem transparent"});}});$("#form_agregar_usuario #emailHelp").html('<i class="fa fa-times" aria-hidden="true"></i> Rellene los campos que faltan');
$("#form_agregar_usuario #emailHelp").css({color:"#1B3156",});return;}else{$("#form_agregar_usuario .form-control").each(function(){$(this).css({"box-shadow":" 0 0 0 0.2rem transparent"});
});}if(e==1){$("#form_agregar_usuario input[name=email]").css({"box-shadow":" 0 0 0 0.2rem rgba(0,123,255,0.25)"});$("#form_agregar_usuario input[name=email]").focus();
$("#form_agregar_usuario #emailHelp").html('<i class="fa fa-times" aria-hidden="true"></i> El correo ya existe');$("#form_agregar_usuario #emailHelp").css({color:"#1B3156",});
return;}else{$("#form_agregar_usuario input[name=email]").css({"box-shadow":" 0 0 0 0.2rem transparent"});}if(e==2){$("#form_agregar_usuario input[name=usuario]").css({"box-shadow":" 0 0 0 0.2rem rgba(0,123,255,0.25)"});
$("#form_agregar_usuario input[name=usuario]").focus();$("#form_agregar_usuario #emailHelp").html('<i class="fa fa-times" aria-hidden="true"></i> El usuario ya existe');
$("#form_agregar_usuario #emailHelp").css({color:"#1B3156",});return;}else{$("#form_agregar_usuario input[name=usuario]").css({"box-shadow":" 0 0 0 0.2rem transparent"});
}if(e==3){c[0].reset();$("#form_agregar_usuario #emailHelp").html('<i class="fa fa-check" aria-hidden="true"></i> Usuario creado correctamente');$("#form_agregar_usuario #emailHelp").css({color:"#1D95D2",});
$("#form_agregar_usuario input[name=nombres]").focus();table=$(".datatable").DataTable();table.ajax.reload();}},error:function(){},});});});function editar_usuario(a){$("#form_modificar_usuario").show();
alertify.modalusuario($("#form_modificar_usuario")[0]).set("selector",'input[name="nombres"]');$.ajax({url:"../User/mostrar_usuario",type:"POST",dataType:"json",data:{id:a,},success:function(c){var b=$("#form_modificar_usuario");
b.find("input[name=id]").val(c[0].id);b.find("input[name=nombres]").val(c[0].usu_nombres);b.find("input[name=apellidos]").val(c[0].usu_apellidos);b.find("input[name=email]").val(c[0].usu_email);
b.find("input[name=telefono]").val(c[0].usu_telefono);b.find("input[name=celular]").val(c[0].usu_celular);b.find("input[name=dni]").val(c[0].usu_dni);b.find("input[name=usuario]").val(c[0].usu_usuario);
b.find("select[name=acceso]").val(c[0].usu_acceso);}});}function editar_password(b){$("#form_modificar_password").show();alertify.modalpassword($("#form_modificar_password")[0]).set("selector",'input[name="password"]');
var a=$("#form_modificar_password");a.find("input[name=id]").val(b);}$(function(){$("#form_modificar_usuario").on("submit",function(g){g.preventDefault();
var c=$(this);var b=c.attr("method");var a=c.attr("action");var d=new FormData(this);d.append("dato","valor");$.ajax({url:a,type:b,dataType:"html",data:d,cache:false,contentType:false,processData:false,beforeSend:function(){$("#form_modificar_usuario .loading").show();
},success:function(e){$("#form_modificar_usuario .loading").hide();if(e==0){$("#form_modificar_usuario .form-control").each(function(){if($(this).val()==""){$(this).css({"box-shadow":" 0 0 0 0.2rem rgba(0,123,255,0.25)"});
}else{$(this).css({"box-shadow":" 0 0 0 0.2rem transparent"});}});$("#form_modificar_usuario #emailHelp").html('<i class="fa fa-times" aria-hidden="true"></i> Rellene los campos que faltan');
return;}if(e==1){c[0].reset();table=$(".datatable").DataTable();table.ajax.reload();$("#form_modificar_usuario #emailHelp").html(" ");}alertify.modalusuario().close();
alertify.notify("<strong>Datos</strong> modificados correctamente.","custom-black",3,function(){});},error:function(){},});});});$(function(){$("#form_modificar_password").on("submit",function(g){g.preventDefault();
var c=$(this);var b=c.attr("method");var a=c.attr("action");var d=new FormData(this);d.append("dato","valor");$.ajax({url:a,type:b,dataType:"html",data:d,cache:false,contentType:false,processData:false,beforeSend:function(){},success:function(e){if(e==0){$("#form_modificar_password .form-control").each(function(){if($(this).val()==""){$(this).css({"box-shadow":" 0 0 0 0.2rem rgba(0,123,255,0.25)"});
}else{$(this).css({"box-shadow":" 0 0 0 0.2rem transparent"});}});$("#form_modificar_password #emailHelp").html('<i class="fa fa-times" aria-hidden="true"></i> Rellene los campos que faltan');
}if(e==1){c[0].reset();table=$(".datatable").DataTable();table.ajax.reload();$("#form_modificar_password #emailHelp").html(" ");}alertify.modalpassword().close();
alertify.notify("<strong>Password</strong> modificado correctamente.","custom-black",3,function(){});},error:function(){},});});});