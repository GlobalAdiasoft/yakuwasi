var documento_var=0;$(document).ready(function(){llamar_factura();$(".two-decimals").change(function(){var c=$(this).val();$(this).val(parseFloat(c).toFixed(2));
});var b=$(".datatable").DataTable({ajax:{url:"../Cobranzas/mostrar_facturas",dataSrc:""},columns:[{data:"id"},{data:"btn_cobranza"},{data:"fact_fecha"},{data:"fac_correlativo"},{data:"fact_condiciones_pago"},{data:"fact_fecha_vencimiento"},{data:"total_factura"},{data:"total_pagado"},{data:"total_por_pagar"},{defaultContent:"<button id='btn_historial' class='btn btn-info btn-sm' ><i class='fas fa-file-invoice-dollar fa-sm'></i> Historial</button>"},],language:{url:"../public/fw/datatables/Spanish.json"},lengthMenu:[[10,15,20,-1],[10,15,20,"All"]],buttons:[{extend:"copyHtml5",text:"Copiar",className:"btn btn-dark btn-sm"},{extend:"excelHtml5",text:"Excel",className:"btn btn-dark btn-sm"},{extend:"csvHtml5",text:"CSV",className:"btn btn-dark btn-sm"},{extend:"pdfHtml5",text:"PDF",className:"btn btn-dark btn-sm"},{extend:"print",text:"IMPRIMIR",className:"btn btn-dark btn-sm",postfixButtons:["colvisRestore"]},],dom:'<"row"<"col-12 col-sm-12 col-md-6"l><"col-12 col-sm-12 col-md-6"f>>rt<"top"B><"col-12"i>p',order:[[0,"desc"]]});
var a=$(".datatable_historial").DataTable({searching:false,bLengthChange:false,paging:false,info:false,ajax:{url:"../Tablacobranzas/mostrar_historial",dataSrc:"",data:function(c){c.documento=documento_var;
}},columns:[{data:"id"},{data:"cobra_documento"},{data:"cobra_fecha_hora"},{data:"cobra_usuario"},{data:"cobra_monto"},],language:{url:"../public/fw/datatables/Spanish.json"},lengthMenu:[[10,15,20,-1],[10,15,20,"All"]]});
abrir_modal("modal_agregar",'<i class="fa fa-bars" aria-hidden="true"></i> Cobranza');abrir_modal("modal_historial",'<i class="fa fa-bars" aria-hidden="true"></i> Historial');
$(".datatable tbody").on("click","#btn_cobranza",function(){var e=b.row($(this).parents("tr")).data();if(e==undefined){var c=$(this).parents("tr");if(c.hasClass("child")){c=c.prev();
}var d=$(".datatable").DataTable().row(c).data();$("#form_agregar")[0].reset();cobranza(d.fac_correlativo,d.total_por_pagar,d.total_pagado);}else{$("#form_agregar")[0].reset();
cobranza(e.fac_correlativo,e.total_por_pagar,e.total_pagado);}});$(".datatable tbody").on("click","#btn_historial",function(){var e=b.row($(this).parents("tr")).data();
if(e==undefined){var c=$(this).parents("tr");if(c.hasClass("child")){c=c.prev();}var d=$(".datatable").DataTable().row(c).data();historial(d.fac_correlativo);
}else{historial(e.fac_correlativo);}});});function llamar_factura(){$.ajax({url:"../Cobranzas/llamar_factura",type:"POST",dataType:"html",success:function(a){$("select[name=facturas]").append(a);
var b="Seleccione Factura";$(".select2-single, .select2-multiple").select2({placeholder:b,width:null,containerCssClass:":all:"});}});}function cobranza(b,c,a){$("#form_agregar").show();
$("input[name=documento]").val(b);$("#form_agregar span.total_pagar").html(c);$("#form_agregar span.total_pagado").html(a);alertify.modal_agregar($("#form_agregar")[0]).set("selector",'select[name="moneda"]');
}function historial(a){documento_var=a;table1=$(".datatable_historial").DataTable();table1.ajax.reload();$("#div_historial").show();alertify.modal_historial($("#div_historial")[0]).set("selector",'select[name="moneda"]');
}$(function(){$("#form_agregar").on("submit",function(g){g.preventDefault();var c=$(this);var b=c.attr("method");var a=c.attr("action");var d=new FormData(this);
d.append("dato","valor");$.ajax({url:a,type:b,dataType:"html",data:d,cache:false,contentType:false,processData:false,beforeSend:function(){alertify.notify(' <img class="loading" src="../public/img/spinner.svg"> Guardando',"custom-black",3600,function(){});
},success:function(e){alertify.dismissAll();alertify.modal_agregar().close();alertify.notify('<i class="fas fa-check"></i> Cobranza Efectuada',"custom-black",4,function(){});
table=$(".datatable").DataTable();table.ajax.reload();},error:function(){},});});});