$(document).ready(function(){$("#form_agregar input[name=nombre]").focus();$("#form_agregar input[name=nombre]").keyup(function(){var c=$(this).val().substring(0,4);
var b=$(this).val().length;$("#form_agregar input[name=codinterno]").val(c+b+"_mar");});var a=$(".datatable").DataTable({ajax:{url:"../Marcas/mostrar",dataSrc:""},columns:[{data:"id"},{data:"mar_codinterno"},{data:"mar_nombre"},{data:"mar_codusuario"},{defaultContent:"<button id='btn_editar' class='btn btn-info btn-sm' ><i class='fas fa-pencil-alt'></i></button>"},{defaultContent:"<button id='btn_eliminar' class='btn btn-danger btn-sm'><i class='far fa-trash-alt'></i></button>"},],language:{url:"../public/fw/datatables/Spanish.json"},lengthMenu:[[10,15,20,-1],[10,15,20,"All"]]});
$(".datatable tbody").on("click","#btn_eliminar",function(){var d=a.row($(this).parents("tr")).data();if(d==undefined){var b=$(this).parents("tr");if(b.hasClass("child")){b=b.prev();
}var c=$(".datatable").DataTable().row(b).data();alertify.confirm('<i class="fa fa-bars" aria-hidden="true"></i> Eliminar',"¿Desea eliminar la familia <strong>"+c.mar_nombre+"</strong>?",function(){eliminar(c.id);
alertify.notify("Se elimino la marca <strong>"+c.mar_nombre+"</strong> correctamente.","custom-black",4,function(){});},function(){alertify.notify("Se cancelo la <strong>eliminación</strong>.","custom-black",4,function(){});
}).set("labels",{ok:"Eliminar",cancel:"Cancelar"});}else{alertify.confirm('<i class="fa fa-bars" aria-hidden="true"></i> Eliminar',"¿Desea eliminar la marca <strong>"+d.mar_nombre+"</strong>?",function(){eliminar(d.id);
alertify.notify("Se elimino la marca <strong>"+d.mar_nombre+"</strong> correctamente.","custom-black",4,function(){});},function(){alertify.notify("Se cancelo la <strong>eliminación</strong>.","custom-black",4,function(){});
}).set("labels",{ok:"Eliminar",cancel:"Cancelar"});}});$(".datatable tbody").on("click","#btn_editar",function(){var d=a.row($(this).parents("tr")).data();
if(d==undefined){var b=$(this).parents("tr");if(b.hasClass("child")){b=b.prev();}var c=$(".datatable").DataTable().row(b).data();editar(c.id);}else{editar(d.id);
}});abrir_modal("modalmarca",'<i class="fa fa-bars" aria-hidden="true"></i> Modificar Marca');});$(function(){$("#form_agregar").on("submit",function(g){g.preventDefault();
var c=$(this);var b=c.attr("method");var a=c.attr("action");var d=new FormData(this);d.append("dato","valor");$.ajax({url:a,type:b,dataType:"html",data:d,cache:false,contentType:false,processData:false,beforeSend:function(){},success:function(e){if(e==1){alertify.notify("Campo <strong>código interno</strong> vacío.","custom",4,function(){});
$("#form_agregar input[name=codinterno]").focus();}if(e==2){alertify.notify("Campo <strong>nombre</strong> vacío.","custom",4,function(){});$("#form_agregar input[name=nombre]").focus();
}if(e==0){c[0].reset();$("#form_agregar input[name=nombre]").focus();table=$(".datatable").DataTable();table.ajax.reload();alertify.notify("Se agrego <strong>marca</strong> correctamente.","custom-black",4,function(){});
}},error:function(){},});});});function eliminar(a){$.ajax({url:"../Marcas/eliminar",type:"POST",dataType:"html",data:{id:a,},success:function(b){table=$(".datatable").DataTable();
table.ajax.reload();}});}function editar(a){$("#form_modificar").show();alertify.modalmarca($("#form_modificar")[0]).set("selector",'input[name="codinterno"]');
$.ajax({url:"../Marcas/mostrar_marca",type:"POST",dataType:"json",data:{id:a,},success:function(c){var b=$("#form_modificar");b.find("input[name=id]").val(c[0].id);
b.find("input[name=codinterno]").val(c[0].mar_codinterno);b.find("input[name=nombre]").val(c[0].mar_nombre);}});}$(function(){$("#form_modificar").on("submit",function(g){g.preventDefault();
var c=$(this);var b=c.attr("method");var a=c.attr("action");var d=new FormData(this);d.append("dato","valor");$.ajax({url:a,type:b,dataType:"html",data:d,cache:false,contentType:false,processData:false,beforeSend:function(){},success:function(e){c[0].reset();
table=$(".datatable").DataTable();table.ajax.reload();alertify.modalmarca().close();alertify.notify("<strong>Marca</strong> modificada correctamente.","custom-black",3,function(){});
},error:function(){},});});});