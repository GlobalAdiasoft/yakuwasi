$(document).ready(function(){$("input[name=nombre]").focus();$("#form_agregar input[name=ganancia]").change(function(){$("#form_agregar input[name=produ_precio_compra_conigv]").trigger("change");
});$("#form_modificar input[name=ganancia]").change(function(){$("#form_modificar input[name=produ_precio_compra_conigv]").trigger("change");});$("#form_agregar input[name=produ_precio_compra_conigv]").change(function(){var e=$("#form_agregar input[name=ganancia]").val();
if(e==0||e==""){e=0;}var c=parseFloat($(this).val());$("#form_agregar input[name=produ_precio_compra_sinigv]").val(c/1.18);$("#form_agregar input[name=produ_precio_ventaconigv]").val(((c*e/100)+c)*1.18);
var d=$("#form_agregar input[name=produ_precio_ventaconigv]").val();$("#form_agregar input[name=produ_precio_ventasinigv]").val(d/1.18);});$("#form_agregar input[name=produ_precio_compra_sinigv]").change(function(){var d=parseFloat($(this).val());
var e=$("#form_agregar input[name=ganancia]").val();if(e==0||e==""){e=0;}$("#form_agregar input[name=produ_precio_compra_conigv]").val(Math.round10(d*1.18));
var c=parseFloat($("#form_agregar input[name=produ_precio_compra_conigv]").val());$("#form_agregar input[name=produ_precio_ventaconigv]").val(((parseFloat(c*e/100))+parseFloat(c))*1.18);
$("#form_agregar input[name=produ_precio_ventasinigv]").val(parseFloat($("#form_agregar input[name=produ_precio_ventaconigv]").val())/1.18);});$("#form_modificar input[name=produ_precio_compra_conigv]").change(function(){var e=$("#form_modificar input[name=ganancia]").val();
if(e==0||e==""){e=0;}var c=parseFloat($(this).val());$("#form_modificar input[name=produ_precio_compra_sinigv]").val(c/1.18);$("#form_modificar input[name=produ_precio_ventaconigv]").val(((c*e/100)+c)*1.18);
var d=$("#form_modificar input[name=produ_precio_ventaconigv]").val();$("#form_modificar input[name=produ_precio_ventasinigv]").val(d/1.18);});$("#form_modificar input[name=produ_precio_compra_sinigv]").change(function(){var d=parseFloat($(this).val());
var e=$("#form_modificar input[name=ganancia]").val();if(e==0||e==""){e=0;}$("#form_modificar input[name=produ_precio_compra_conigv]").val(Math.round10(d*1.18));
var c=parseFloat($("#form_modificar input[name=produ_precio_compra_conigv]").val());$("#form_modificar input[name=produ_precio_ventaconigv]").val(((parseFloat(c*e/100))+parseFloat(c))*1.18);
$("#form_modificar input[name=produ_precio_ventasinigv]").val(parseFloat($("#form_modificar input[name=produ_precio_ventaconigv]").val())/1.18);});$("#form_agregar input[name=produ_precio_ventaconigv]").change(function(){$("#form_agregar input[name=produ_precio_ventasinigv]").val(parseFloat($("#form_agregar input[name=produ_precio_ventaconigv]").val())/1.18);
});$("#form_modificar input[name=produ_precio_ventaconigv]").change(function(){$("#form_modificar input[name=produ_precio_ventasinigv]").val(parseFloat($("#form_modificar input[name=produ_precio_ventaconigv]").val())/1.18);
});$("#form_agregar input[name=nombre]").change(function(){var e=$(this).val().substring(0,3);var c=$(this).val().length;$("#form_agregar input[name=cod_articulo]").val(e+c+"_art");
$("#form_agregar input[name=codbarras]").val(e+c+"_art");mostrar_cod_bar(e+c+"_art");var f=e+c+"_art";var d=$("#file_especificacion").uploadFile({url:"../Articulos/upload_especificacion/",fileName:"especificaciontecnica",acceptFiles:".pdf",allowedTypes:"pdf",autoSubmit:true,formData:{archivo:f,},maxFileSize:5000000,});
var g=$("#file_imagen").uploadFile({url:"../Articulos/upload_imagen",fileName:"imagen",acceptFiles:"image/*",autoSubmit:true,formData:{archivo:f,},maxFileSize:5000000,});
$(".resetdatos").click(function(){d.reset();g.reset();});});mostrar_familia();mostrar_marca();mostrar_fabricante();mostrar_unidad_medida();mostrar_proveedor();
mostrar_ubicacion();var b=$(".datatable").DataTable({ajax:{url:"../Articulos/mostrar",dataSrc:""},columns:[{data:"id"},{data:"art_nombre"},{data:"art_familia"},{data:"art_marca"},{data:"art_fabricante"},{data:"art_descripcion"},{data:"art_unidadmedida"},{data:"art_ubicacion"},{data:"art_stock"},{data:"art_stockminimo"},{data:"art_codigo"},{data:"art_especificaciontecnica"},{data:"art_imagen"},{data:"art_estado"},{data:"art_proveedor"},{data:"art_impuesto"},{data:"art_codbarras"},{data:"art_moneda"},{data:"art_ganancia"},{data:"art_precio_compra_sinigv"},{data:"art_precio_compra_conigv"},{data:"art_precio_ventasinigv"},{data:"art_precio_ventaconigv"},{data:"art_codusuario"},{data:"art_fechaalta"},{defaultContent:"<button id='btn_editar' class='btn btn-info btn-sm' ><i class='fas fa-pencil-alt'></i></button>"},{defaultContent:"<button id='btn_eliminar' class='btn btn-danger btn-sm'><i class='far fa-trash-alt'></i></button>"},{defaultContent:"<button id='btn_kardex' class='btn btn-info btn-sm'>Kardex</button>"},],language:{url:"../public/fw/datatables/Spanish.json"},lengthMenu:[[10,15,20,-1],[10,15,20,"All"]],buttons:[{extend:"copyHtml5",text:"Copiar",className:"btn btn-dark btn-sm"},{extend:"excelHtml5",text:"Excel",className:"btn btn-dark btn-sm"},{extend:"csvHtml5",text:"CSV",className:"btn btn-dark btn-sm"},{extend:"pdfHtml5",text:"PDF",className:"btn btn-dark btn-sm"},{extend:"print",text:"IMPRIMIR",className:"btn btn-dark btn-sm",postfixButtons:["colvisRestore"]},],dom:'<"row"<"col-12 col-sm-12 col-md-6"l><"col-12 col-sm-12 col-md-6"f>>rt<"top"B><"col-12"i>p',order:[[0,"desc"]]});
var a=$(".datatable1").DataTable({ajax:{url:"../Kardex/mostrar_kardex",dataSrc:"",data:function(c){c.nrokardex=$("input[name=nrokardex]").val();}},columns:[{data:"id"},{data:"articulo"},{data:"cod_articulo"},{data:"fecha"},{data:"hora"},{data:"ingreso"},{data:"salida"},{data:"saldo"},{data:"usuario"},{data:"documento"},{data:"correlativo"},{data:"proveedor"},{data:"observaciones"},],language:{url:"../public/fw/datatables/Spanish.json"},lengthMenu:[[10,15,20,-1],[10,15,20,"All"]],buttons:[{extend:"copyHtml5",text:"Copiar",className:"btn btn-dark btn-sm"},{extend:"excelHtml5",text:"Excel",className:"btn btn-dark btn-sm"},{extend:"csvHtml5",text:"CSV",className:"btn btn-dark btn-sm"},{extend:"pdfHtml5",text:"PDF",className:"btn btn-dark btn-sm"},{extend:"print",text:"IMPRIMIR",className:"btn btn-dark btn-sm",postfixButtons:["colvisRestore"]},],dom:'<"row"<"col-12 col-sm-12 col-md-6"l><"col-12 col-sm-12 col-md-6"f>>rt<"top"B><"col-12"i>p',order:[[0,"desc"]]});
$(".datatable tbody").on("click","#btn_eliminar",function(){var e=b.row($(this).parents("tr")).data();if(e==undefined){var c=$(this).parents("tr");if(c.hasClass("child")){c=c.prev();
}var d=$(".datatable").DataTable().row(c).data();alertify.confirm('<i class="fa fa-bars" aria-hidden="true"></i> Eliminar',"¿Desea eliminar el artículo <strong>"+d.art_nombre+"</strong>?",function(){eliminar(d.id);
alertify.notify("Se elimino el artículo <strong>"+d.art_nombre+"</strong> correctamente.","custom-black",4,function(){});},function(){alertify.notify("Se cancelo la <strong>eliminación</strong>.","custom-black",4,function(){});
}).set("labels",{ok:"Eliminar",cancel:"Cancelar"});}else{alertify.confirm('<i class="fa fa-bars" aria-hidden="true"></i> Eliminar',"¿Desea eliminar el artículo <strong>"+e.art_nombre+"</strong>?",function(){eliminare(e.id);
alertify.notify("Se elimino el artículo <strong>"+e.art_nombre+"</strong> correctamente.","custom-black",4,function(){});},function(){alertify.notify("Se cancelo la <strong>eliminación</strong>.","custom-black",4,function(){});
}).set("labels",{ok:"Eliminar",cancel:"Cancelar"});}});$(".datatable tbody").on("click","#btn_editar",function(){var e=b.row($(this).parents("tr")).data();
if(e==undefined){var c=$(this).parents("tr");if(c.hasClass("child")){c=c.prev();}var d=$(".datatable").DataTable().row(c).data();modificar(d.id);}else{modificar(e.id);
}});$(".datatable tbody").on("click","#btn_kardex",function(){var e=b.row($(this).parents("tr")).data();if(e==undefined){var c=$(this).parents("tr");if(c.hasClass("child")){c=c.prev();
}var d=$(".datatable").DataTable().row(c).data();modal_kardex(d.id);}else{modal_kardex(e.id);}});$(".datatable tbody").on("click","#btn_editar_especificaciones",function(){var e=b.row($(this).parents("tr")).data();
if(e==undefined){var c=$(this).parents("tr");if(c.hasClass("child")){c=c.prev();}var d=$(".datatable").DataTable().row(c).data();modificar_especificaciones(d.id);
}else{modificar_especificaciones(e.id);}});$(".datatable tbody").on("click","#btn_editar_imagenes",function(){var e=b.row($(this).parents("tr")).data();
if(e==undefined){var c=$(this).parents("tr");if(c.hasClass("child")){c=c.prev();}var d=$(".datatable").DataTable().row(c).data();modificar_imagenes(d.id);
}else{modificar_imagenes(e.id);}});abrir_modal("modalagregar",'<i class="fa fa-bars" aria-hidden="true"></i> Agregar Artículo <br> <small><i class="far fa-edit"></i> Aquí podrá agregar nuevos artículos.</small>');
abrir_modal("modalmodificar",'<i class="fa fa-bars" aria-hidden="true"></i> Modificar Articulo <br> <small><i class="far fa-edit"></i> Aquí podrá modificar los artículos.</small>');
abrir_modal("modalkardex",'<i class="fa fa-bars" aria-hidden="true"></i> Kadex Artículo');$("#btn_agregar").click(function(){$("#form_agregar").show();
alertify.modalagregar($("#form_agregar")[0]).set("selector",'input[name="nombre"]');actualizar_select2();});});function mostrar_familia(){$.ajax({url:"../Familias/mostrar_select",type:"POST",dataType:"html",success:function(a){$("select[name = familia]").append(a);
$("select[name = familia]").select2();}});}function mostrar_marca(){$.ajax({url:"../Marcas/mostrar_select",type:"POST",dataType:"html",success:function(a){$("select[name = marca]").append(a);
$("select[name = marca]").select2();actualizar_select2();}});}function mostrar_ubicacion(){$.ajax({url:"../Ubicacion/mostrar_select",type:"POST",dataType:"html",success:function(a){$("select[name = ubicacion]").append(a);
$("select[name = ubicacion]").select2();actualizar_select2();}});}function mostrar_fabricante(){$.ajax({url:"../Fabricantes/mostrar_select",type:"POST",dataType:"html",success:function(a){$("select[name = fabricante]").append(a);
$("select[name = fabricante]").select2();actualizar_select2();}});}function mostrar_unidad_medida(){$.ajax({url:"../Unidades/mostrar_select",type:"POST",dataType:"html",success:function(a){$("select[name = unidad_medida]").append(a);
$("select[name = unidad_medida]").select2();}});}function mostrar_proveedor(){$.ajax({url:"../Proveedores/mostrar_select",type:"POST",dataType:"html",success:function(a){$("select[name = proveedor]").append(a);
$("select[name = proveedor]").select2();}});}function mostrar_cod_bar(a){$.ajax({url:"../Barcode/generar",type:"POST",dataType:"html",data:{code:a,},success:function(b){$("#imagen_cod_bar").html(b);
}});}$(function(){$("#form_agregar").on("submit",function(g){g.preventDefault();var c=$(this);var b=c.attr("method");var a=c.attr("action");var d=new FormData(this);
d.append("dato","valor");$.ajax({url:a,type:b,dataType:"html",data:d,cache:false,contentType:false,processData:false,beforeSend:function(){},success:function(e){if(e==0){$("input[name=nombre]").focus();
alertify.notify("Ya existe articulo con ese nombre.","custom",4,function(){});return;}else{$("#form_agregar select[name = familia]").select2("destroy");
$("#form_agregar select[name = marca]").select2("destroy");$("#form_agregar select[name = fabricante]").select2("destroy");$("#form_agregar select[name = unidad_medida]").select2("destroy");
$("#form_agregar select[name = proveedor]").select2("destroy");c[0].reset();$("#form_agregar select[name = familia]").select2();$("#form_agregar select[name = marca]").select2();
$("#form_agregar select[name = fabricante]").select2();$("#form_agregar select[name = unidad_medida]").select2();$("#form_agregar select[name = proveedor]").select2();
$("input[name=nombre]").focus();alertify.notify("Se agregro <strong>articulo</strong> correctamente.","custom-black",4,function(){});table=$(".datatable").DataTable();
table.ajax.reload();alertify.modalagregar().close();}$(".resetdatos").trigger("click");},error:function(){},});});});function eliminar(a){$.ajax({url:"../Articulos/eliminar",type:"POST",dataType:"html",data:{id:a,},success:function(b){table=$(".datatable").DataTable();
table.ajax.reload();}});}function modificar(a){$("#form_modificar").show();alertify.modalmodificar($("#form_modificar")[0]).set("selector",'input[name="nombre"]');
$.ajax({url:"../Articulos/mostrar_articulo",type:"POST",dataType:"json",data:{id:a,},success:function(c){var b=$("#form_modificar");$("#form_modificar select[name=familia]").select2("destroy");
$("#form_modificar select[name=marca]").select2("destroy");$("#form_modificar select[name=fabricante]").select2("destroy");$("#form_modificar select[name=unidad_medida]").select2("destroy");
$("#form_modificar select[name=proveedor]").select2("destroy");b.find("input[name=id]").val(c[0].id);b.find("input[name=nombre]").val(c[0].art_nombre);
b.find("select[name=familia]").val(c[0].art_familia);b.find("select[name=marca]").val(c[0].art_marca);b.find("select[name=fabricante]").val(c[0].art_fabricante);
b.find("textarea[name=descripcion]").val(c[0].art_descripcion);b.find("select[name=unidad_medida]").val(c[0].art_unidadmedida);b.find("select[name=ubicacion]").val(c[0].art_ubicacion);
b.find("input[name=codbarras]").val(c[0].art_codbarras);b.find("input[name=cod_articulo]").val(c[0].art_codigo);b.find("select[name=estado]").val(c[0].art_estado);
b.find("select[name=proveedor]").val(c[0].art_proveedor);b.find("input[name=impuesto]").val(c[0].art_impuesto);b.find("input[name=stock]").val(c[0].art_stock);
b.find("input[name=stockminimo]").val(c[0].art_stockminimo);b.find("select[name=moneda]").val(c[0].art_moneda);b.find("input[name=ganancia]").val(c[0].art_ganancia);
b.find("input[name=produ_precio_compra_sinigv]").val(c[0].art_precio_compra_sinigv);b.find("input[name=produ_precio_compra_conigv]").val(c[0].art_precio_compra_conigv);
b.find("input[name=produ_precio_ventasinigv]").val(c[0].art_precio_ventasinigv);b.find("input[name=produ_precio_ventaconigv]").val(c[0].art_precio_ventaconigv);
$("select[name = familia]").select2();$("select[name = marca]").select2();$("select[name = fabricante]").select2();$("select[name = unidad_medida]").select2();
$("select[name = proveedor]").select2();}});}$(function(){$("#form_modificar").on("submit",function(g){g.preventDefault();var c=$(this);var b=c.attr("method");
var a=c.attr("action");var d=new FormData(this);d.append("dato","valor");$.ajax({url:a,type:b,dataType:"html",data:d,cache:false,contentType:false,processData:false,beforeSend:function(){},success:function(e){if(e==1){c[0].reset();
table=$(".datatable").DataTable();table.ajax.reload();alertify.modalmodificar().close();alertify.notify("<strong>Datos</strong> modificados correctamente.","custom-black",3,function(){});
}},error:function(){},});});});function modificar_especificaciones(a){$.ajax({url:"../Articulos/modificar_especificaciones",type:"POST",dataType:"json",data:{id:a,},success:function(b){}});
}function modificar_imagenes(){alert("imagenes");}function modal_kardex(a){$("#kardex").show();alertify.modalkardex($("#kardex")[0]);$("input[name=nrokardex]").val(a);
table1=$(".datatable1").DataTable();table1.ajax.reload();}