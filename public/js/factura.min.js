$(window).on("beforeunload",function(){console.log("hola");});$(window).load(function(){mostrar_ubigeo();$("input[name=caja_documento]").val($("#form_agregar_factura input[name=serie]").val());
$("input[name=caja_numero]").val($("#form_agregar_factura input[name=numero_factura]").val());});$(document).ready(function(){$("input[name=total_pago]").change(function(){var c=$("input[name=total_caja]").val();
var b=$("input[name=total_pago]").val();var d=b-c;$("input[name=total_vuelto]").val(parseFloat(d).toFixed(2));});$("input[name=total_pago]").blur(function(){this.value=parseFloat(this.value).toFixed(2);
});$("input[name=total_caja]").blur(function(){this.value=parseFloat(this.value).toFixed(2);});$("input[name=total_vuelto]").blur(function(){this.value=parseFloat(this.value).toFixed(2);
});verificarnumerofactura();verificar_numero_pedido();$("#btn_facturar").click(function(){facturar();});llamar_rucs("FAC");$("input[name=cli_id]").change(function(){llamar_cliente();
});$("input[name=codproducto]").change(function(){cod_producto($(this).val());});llamar_codpro();$("#form_agregar_factura input[name=moneda]").val($("#form_agregar_factura select[name=moneda_change]").val());
$("#form_agregar_factura select[name=moneda_change]").change(function(){$("#form_agregar_factura input[name=moneda]").val($(this).val());});var a=$(".datatable").DataTable({searching:false,bLengthChange:false,paging:false,info:false,ajax:{url:"../Pedidos/tabla_itemspedido",dataSrc:"",data:function(b){b.codigo_pedido=$("input[name=codigo_pedido]").val();
}},columns:[{data:"id"},{data:"ped_cantidad"},{data:"ped_cod_pro"},{data:"ped_nombre_pro"},{data:"ped_valor_venta_sin_igv"},{data:"ped_total"},{defaultContent:"<button id='btn_eliminar' class='btn btn-danger btn-sm'><i class='far fa-trash-alt'></i></button>"},],language:{url:"../public/fw/datatables/Spanish.json"},lengthMenu:[[100,-1],[100,"All"]]});
$(".datatable tbody").on("click","#btn_eliminar",function(){var d=a.row($(this).parents("tr")).data();if(d==undefined){var b=$(this).parents("tr");if(b.hasClass("child")){b=b.prev();
}var c=$(".datatable").DataTable().row(b).data();alertify.confirm('<i class="fa fa-bars" aria-hidden="true"></i> Eliminar',"¿Desea eliminar item <strong>"+c.ped_nombre_pro+"</strong>?",function(){eliminar_item(c.id);
alertify.notify("Se elimino el item <strong>"+c.ped_nombre_pro+"</strong> correctamente.","custom-black",4,function(){});},function(){alertify.notify("Se cancelo la <strong>eliminación</strong>.","custom-black",4,function(){});
}).set("labels",{ok:"Eliminar",cancel:"Cancelar"});}else{alertify.confirm('<i class="fa fa-bars" aria-hidden="true"></i> Eliminar',"¿Desea eliminar item <strong>"+d.ped_nombre_pro+"</strong>?",function(){eliminar_item(d.id);
alertify.notify("Se elimino el item <strong>"+d.ped_nombre_pro+"</strong> correctamente.","custom-black",4,function(){});},function(){alertify.notify("Se cancelo la <strong>eliminación</strong>.","custom-black",4,function(){});
}).set("labels",{ok:"Eliminar",cancel:"Cancelar"});}});abrir_modal("modalagregar",'<i class="fa fa-bars" aria-hidden="true"></i> Agregar Cliente <br> <small><i class="far fa-edit"></i> Aquí podrá agregar clientes.</small>');
$("#btn_agregar").click(function(){$("#form_agregar_cliente").show();alertify.modalagregar($("#form_agregar_cliente")[0]).set("selector",'input[name="ruc"]');
actualizar_select2();});});function verificarnumerofactura(){var a=$("#form_agregar_factura input[name=serie]").val();$.ajax({url:"../Listapedidos/verificarnumerofactura",type:"POST",dataType:"html",data:{correlativo:a},success:function(b){$("#form_agregar_factura input[name=numero_factura]").val(b);
}});}function verificar_numero_pedido(){$.ajax({url:"../Pedidos/llamar_codigo_pedido",type:"POST",dataType:"html",success:function(a){$("#form_agregar_factura input[name=codigo_pedido]").val(a);
}});}function llamar_rucs(a){$.ajax({url:"../Clientes/llamar_rucs/"+a,type:"POST",dataType:"html",success:function(b){$("#datalist_rucs").html(b);}});}function llamar_cliente(){var a=$("input[name=cli_id]").val();
a=a.split("|");$.ajax({url:"../Clientes/llamar_cliente",type:"POST",dataType:"html",data:{id:$.trim(a[0]),},success:function(b){if(b=="vacio"){alertify.notify("No se encontraron resultados del <strong>Cliente</strong>","custom",5,function(){});
$("input[name=cli_id]").focus();$("#cli_nombre").text("");$("#cli_ruc").text(" ");$("#cli_ubigeo").text(" ");$("#cli_direccion").text(" ");$("#cli_telefono").text(" ");
$("#cli_celular").text(" ");}else{var c=JSON.parse(b);$("#cli_nombre").text(c[0].cli_nombre);$("#cli_ruc").text(c[0].cli_ruc);$("#cli_ubigeo").text(c[0].cli_ubigeo);
$("#cli_direccion").text(c[0].cli_direccion);$("#cli_telefono").text(c[0].cli_telefono);$("#cli_celular").text(c[0].cli_celular);}}});}function cod_producto(a){var c=a;
var b=c.split("|");var a=b[0];$.ajax({url:"../Pedidos/codpro",type:"POST",dataType:"JSON",data:{codart:a,},success:function(f){if(f==0){$("input[name=producto]").val("");
$("input[name=preciounitario]").val("");$("input[name=total]").val("");$("input[name=stock]").val("");}else{$("input[name=producto]").val(f[0].art_nombre);
$("input[name=valor_venta_sin_igv]").val(f[0].art_precio_ventasinigv);$("input[name=pro_id]").val(f[0].id);$("input[name=stock]").val(f[0].art_stock);var d=$("input[name=cantidad]").val();
var g=$("input[name=valor_venta_sin_igv]").val();var e=d*g;$("input[name=total]").val(e);}}});}function llamar_codpro(){$.ajax({url:"../Articulos/llamar_codpro",type:"POST",dataType:"html",success:function(a){$("#datalist_codpro").html(a);
}});}$(function(){$("#form_agregar_factura").on("submit",function(g){g.preventDefault();var c=$(this);var b=c.attr("method");var a=c.attr("action");var d=new FormData(this);
d.append("dato","valor");$.ajax({url:a,type:b,dataType:"html",data:d,cache:false,contentType:false,processData:false,beforeSend:function(){},success:function(f){var e=$("#form_agregar_pedido input[name=codproducto]").val();
if(f==4){alertify.notify("No se encontro <strong>Cliente</strong> en nuestra base de datos.","custom",5,function(){});$("input[name=cli_id]").focus();return;
}if(f==3){alertify.notify("No existe el producto <strong>"+e+"</strong> en nuestra base de datos.","custom",5,function(){});$("#form_agregar_pedido input[name=codproducto]").focus();
return;}if(f==1){alertify.notify("No cuenta con stock suficiente del producto <strong>"+e+".</strong>","custom",5,function(){});$("#form_agregar_pedido input[name=cantidad]").focus();
return;}if(f==2){alertify.notify("Stock mínimo del producto <strong>"+e+".</strong>","custom",5,function(){});}c.find("input[name=cantidad]").val("1");
c.find("input[name=codproducto]").val("");c.find("input[name=producto]").val("");c.find("input[name=valor_venta_sin_igv]").val("");c.find("input[name=total]").val("");
c.find("input[name=cli_id]").prop("readonly",true);c.find("select[name=tipo_documento_sel]").prop("disabled",true);c.find("input[name=stock]").val("");
$("input[name=codproducto]").focus();alertify.notify("Agregado <strong>pedido</strong> correctamente.","custom-black",5,function(){});var h=$(".datatable").DataTable();
h.ajax.reload();tabla_itemspedido_totales();aprobar();},error:function(){},});});});function aprobar(){var a=$("#form_agregar_factura input[name=codigo_pedido]").val();
$.ajax({url:"../Listapedidos/aprobar2",type:"POST",dataType:"html",data:{pedido:a},success:function(b){table=$(".datatable_lista").DataTable();table.ajax.reload();
}});}function tabla_itemspedido_totales(){var a=$("input[name=codigo_pedido]").val();$.ajax({url:"../Pedidos/tabla_itemspedido_totales",type:"POST",dataType:"json",data:{codigo_pedido:a,},success:function(b){$(".label_subtotal,.label_igv,.label_total").html("");
$(".label_subtotal").html(b[0].subtotal);$(".label_igv").html(b[0].igv);$(".label_total").html(b[0].total);$("input[name=total_caja]").val(b[0].total);
$("input[name=total_pago]").val(b[0].total);$("input[name=total_pago]").trigger("change");}});}function facturar(){if($("input[name=total_pago]").val()==""||$("input[name=total_pago]").val()=="0"||$("input[name=total_pago]").val()=="0.00"){$("input[name=total_pago]").val("0");
$("input[name=total_pago]").focus();alertify.notify("Ingrese <strong>monto</strong> recibido","custom-black",4,function(){});}else{var c=$("#form_agregar_factura");
var b=c.attr("method");var a="../Facturar/crear_factura2";var d=new FormData(document.getElementById("form_agregar_factura"));d.append("dato","valor");
$.ajax({url:a,type:b,dataType:"html",data:d,cache:false,contentType:false,processData:false,beforeSend:function(){alertify.notify(' <img class="loading" src="../public/img/spinner.svg"> Enviando <strong>Factura</strong> a <img class="alertify-sunat" src="../public/img/sunat.png" alt="">',"custom-black",3600,function(){});
},success:function(e){console.log(e);alertify.dismissAll();if(e==0){$(".btn_caja").trigger("click");alertify.notify("<strong>Factura</strong> enviada correctamente","custom-black",1,function(){location.reload();
});}else{alertify.notify(e,"custom",5,function(){});table=$(".datatable_lista").DataTable();table.ajax.reload();}},error:function(){},});}}$(function(){$("#form_agregar_caja").on("submit",function(g){g.preventDefault();
var c=$(this);var b=c.attr("method");var a=c.attr("action");var d=new FormData(this);d.append("dato","valor");$.ajax({url:a,type:b,dataType:"html",data:d,cache:false,contentType:false,processData:false,beforeSend:function(){},success:function(e){},error:function(){},});
});});function btn_facturar(){if($("input[name=total_pago]").val()==""||$("input[name=total_pago]").val()=="0"||$("input[name=total_pago]").val()=="0.00"){$("input[name=total_pago]").val("0");
$("input[name=total_pago]").focus();alertify.notify("Ingrese <strong>monto</strong> recibido","custom_m",4,function(){});}else{$(".btn_caja").trigger("click");
}}$(function(){$("#form_agregar_cliente").on("submit",function(g){g.preventDefault();var c=$(this);var b=c.attr("method");var a=c.attr("action");var d=new FormData(this);
d.append("dato","valor");$.ajax({url:a,type:b,dataType:"html",data:d,cache:false,contentType:false,processData:false,beforeSend:function(){},success:function(e){c[0].reset();
llamar_rucs("FAC");alertify.modalagregar().close();},error:function(){},});});});function mostrar_ubigeo(){$.ajax({url:"../Clientes/mostrar_ubigeo2",type:"POST",dataType:"html",success:function(a){$("select[name = ubigeo]").append(a);
var b="Seleccione Ciudad,Provincia,Distrito";$.fn.select2.defaults.set("theme","bootstrap");$(".select2-single, .select2-multiple").select2({placeholder:b,width:null,containerCssClass:":all:"});
}});}