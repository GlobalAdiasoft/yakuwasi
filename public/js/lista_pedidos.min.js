$(window).load(function(){});$(document).ready(function(){$("#form_agregar_caja_boleta input[name=total_pago]").change(function(){var c=$("#form_agregar_caja_boleta input[name=total_caja]").val();
var b=$("#form_agregar_caja_boleta input[name=total_pago]").val();var d=b-c;$("#form_agregar_caja_boleta input[name=total_vuelto]").val(parseFloat(d).toFixed(2));
});$("#form_agregar_caja_factura input[name=total_pago]").change(function(){var c=$("#form_agregar_caja_factura input[name=total_caja]").val();var b=$("#form_agregar_caja_factura input[name=total_pago]").val();
var d=b-c;$("#form_agregar_caja_factura input[name=total_vuelto]").val(parseFloat(d).toFixed(2));});$("input[name=total_pago]").blur(function(){this.value=parseFloat(this.value).toFixed(2);
});$("input[name=total_caja]").blur(function(){this.value=parseFloat(this.value).toFixed(2);});$("input[name=total_vuelto]").blur(function(){this.value=parseFloat(this.value).toFixed(2);
});$("#form_factura select[name=condiciones_pago]").change(function(){condicionesdepago(this);});$("#form_factura select[name=medio_pago_change]").change(function(){mediosdepago(this);
});$("#form_boleta select[name=medio_pago_change]").change(function(){mediosdepago_boleta(this);});$("#form_factura select[name=sunat_transaccion_change]").change(function(){verificar_sunat_transaccion(this);
});$("#form_boleta select[name=sunat_transaccion_change]").change(function(){verificar_sunat_transaccion_boleta(this);});$("#form_factura select[name=modena_change]").change(function(){tipodecambio(this);
});$("#form_boleta select[name=modena_change]").change(function(){tipodecambio_boleta(this);});$("select[name=busqueda]").change(function(){a.ajax.reload();
});var a=$(".datatable_lista").DataTable({responsive:true,ajax:{url:"../Listapedidos/mostrar",dataSrc:"",data:function(b){b.busqueda=$("select[name=busqueda]").val();
}},columns:[{data:"id"},{data:"usuario_cod"},{data:"ped_cod_ped"},{data:"ped_tipo_doc"},{data:"ped_usuario"},{data:"ped_fecha"},{data:"ped_cli_id"},{data:"ped_aprobacion"},{data:"ped_moneda"},{data:"ped_tipocambio"},{data:"eliminar"},],language:{url:"../public/fw/datatables/Spanish.json"},lengthMenu:[[10,15,20,-1],[10,15,20,"All"]],order:[[0,"desc"]]});
$(".datatable_lista tbody").on("click","#generar_factura",function(){$("#div_form_factura").show();var g=$("#form_factura");alertify.modal_factura($("#div_form_factura")[0]).set("selector",'select[name="moneda"]');
verificarnumerofactura();verificar_sunat_transaccion($("#form_factura select[name=sunat_transaccion_change]"));mediosdepago($("#form_factura select[name=medio_pago_change]"));
$("#form_agregar_caja_factura input[name=caja_documento]").val($("#form_factura input[name=serie]").val());var e=a.row($(this).parents("tr")).data();if(e==undefined){var c=$(this).parents("tr");
if(c.hasClass("child")){c=c.prev();}var d=$(".datatable_lista").DataTable().row(c).data();var b=d.ped_cli_id;b=b.split(" ");g.find("input[name=cli_id]").val(b[0]);
$("#form_factura input[name=pedido_usuario]").val(d.ped_cod_ped+"/"+d.ped_usuario);llamar_cliente($("#form_factura"));$("#form_factura select[name=modena_change]").val(d.ped_moneda);
tipodecambio($("#form_factura select[name=modena_change]"));$("#form_factura input[name=tipocambio]").val(d.ped_tipocambio);tabla_itemspedido_totales_pedidos(d.ped_cod_ped,d.ped_usuario,g);
$("#form_factura input[name=codigo_pedido]").val(d.ped_cod_ped);}else{var b=e.ped_cli_id;b=b.split(" ");g.find("input[name=cli_id]").val(b[0]);$("#form_factura input[name=pedido_usuario]").val(e.ped_cod_ped+"/"+e.ped_usuario);
llamar_cliente($("#form_factura"));$("#form_factura select[name=modena_change]").val(e.ped_moneda);tipodecambio($("#form_factura select[name=modena_change]"));
$("#form_factura input[name=tipocambio]").val(e.ped_tipocambio);tabla_itemspedido_totales_pedidos(e.ped_cod_ped,e.ped_usuario,g);$("#form_factura input[name=codigo_pedido]").val(e.ped_cod_ped);
}});$(".datatable_lista tbody").on("click","#generar_boleta",function(){$("#div_form_boleta").show();var g=$("#form_boleta");alertify.modal_boleta($("#div_form_boleta")[0]).set("selector",'select[name="moneda"]');
verificarnumeroboleta();verificar_sunat_transaccion_boleta($("#form_boleta select[name=sunat_transaccion_change]"));mediosdepago_boleta($("#form_boleta select[name=medio_pago_change]"));
$("#form_agregar_caja_boleta input[name=caja_documento]").val($("#form_boleta input[name=serie]").val());var e=a.row($(this).parents("tr")).data();if(e==undefined){var c=$(this).parents("tr");
if(c.hasClass("child")){c=c.prev();}var d=$(".datatable_lista").DataTable().row(c).data();var b=d.ped_cli_id;b=b.split(" ");g.find("input[name=cli_id]").val(b[0]);
$("#form_boleta input[name=pedido_usuario]").val(d.ped_cod_ped+"/"+d.ped_usuario);llamar_cliente($("#form_boleta"));$("#form_boleta select[name=modena_change]").val(d.ped_moneda);
tipodecambio_boleta($("#form_boleta select[name=modena_change]"));$("#form_boleta input[name=tipocambio]").val(d.ped_tipocambio);tabla_itemspedido_totales_pedidos_boleta(d.ped_cod_ped,d.ped_usuario,g);
$("#form_boleta input[name=codigo_pedido]").val(d.ped_cod_ped);}else{$("#form_boleta select[name=codigo_pedido]").val(e.ped_cod_ped);var b=e.ped_cli_id;
b=b.split(" ");g.find("input[name=cli_id]").val(b[0]);$("#form_boleta input[name=pedido_usuario]").val(e.ped_cod_ped+"/"+e.ped_usuario);llamar_cliente($("#form_boleta"));
$("#form_boleta select[name=modena_change]").val(e.ped_moneda);tipodecambio_boleta($("#form_boleta select[name=modena_change]"));$("#form_boleta input[name=tipocambio]").val(e.ped_tipocambio);
tabla_itemspedido_totales_pedidos_boleta(e.ped_cod_ped,e.ped_usuario,g);$("#form_boleta input[name=codigo_pedido]").val(e.ped_cod_ped);}});$(".datatable_lista tbody").on("click","#btn_eliminar",function(){var d=a.row($(this).parents("tr")).data();
if(d==undefined){var b=$(this).parents("tr");if(b.hasClass("child")){b=b.prev();}var c=$(".datatable_lista").DataTable().row(b).data();alertify.confirm('<i class="fa fa-bars" aria-hidden="true"></i> Eliminar',"¿Desea eliminar el pedido <strong>"+c.ped_cod_ped+"</strong>?",function(){eliminar_pedido(c.ped_cod_ped,c.ped_usuario);
alertify.notify("Se elimino el pedido <strong>"+c.ped_cod_ped+"</strong> correctamente.","custom-black",4,function(){});},function(){alertify.notify("Se cancelo la <strong>eliminación</strong>.","custom-black",4,function(){});
}).set("labels",{ok:"Eliminar",cancel:"Cancelar"});}else{alertify.confirm('<i class="fa fa-bars" aria-hidden="true"></i> Eliminar',"¿Desea eliminar el pedido <strong>"+d.ped_cod_ped+"</strong>?",function(){eliminar_pedido(d.ped_cod_ped,d.ped_usuario);
alertify.notify("Se elimino el pedido <strong>"+d.ped_cod_ped+"</strong> correctamente.","custom-black",4,function(){});},function(){alertify.notify("Se cancelo la <strong>eliminación</strong>.","custom-black",4,function(){});
}).set("labels",{ok:"Eliminar",cancel:"Cancelar"});}});abrir_modal("modal_factura",'<i class="fa fa-bars" aria-hidden="true"></i> Factura');abrir_modal("modal_boleta",'<i class="fa fa-bars" aria-hidden="true"></i> Boleta');
});function aprobar(a){$.ajax({url:"../Listapedidos/aprobar",type:"POST",dataType:"html",data:{id:a},success:function(b){table=$(".datatable_lista").DataTable();
table.ajax.reload();}});}function rechazar(a){$.ajax({url:"../Listapedidos/rechazar",type:"POST",dataType:"html",data:{id:a},success:function(b){table=$(".datatable_lista").DataTable();
table.ajax.reload();}});}function llamar_cliente(a){var b=a.find("input[name=cli_id]").val();$.ajax({url:"../Clientes/llamar_cliente",type:"POST",dataType:"html",data:{id:b,},success:function(c){if(c=="vacio"){alertify.notify("No se encontraron resultados del <strong>Cliente</strong>","custom",5,function(){});
a.find("input[name=cli_id]").focus();a.find("#cli_nombre").text("");a.find("#cli_ruc").text(" ");a.find("#cli_ubigeo").text(" ");a.find("#cli_direccion").text(" ");
a.find("#cli_telefono").text(" ");a.find("#cli_celular").text(" ");}else{var d=JSON.parse(c);a.find("#cli_nombre").text(d[0].cli_nombre);a.find("#cli_ruc").text(d[0].cli_ruc);
a.find("#cli_ubigeo").text(d[0].cli_ubigeo);a.find("#cli_direccion").text(d[0].cli_direccion);a.find("#cli_telefono").text(d[0].cli_telefono);a.find("#cli_celular").text(d[0].cli_celular);
}}});}function verificarnumerofactura(){var a=$("#form_factura input[name=serie]").val();$.ajax({url:"../Listapedidos/verificarnumerofactura",type:"POST",dataType:"html",data:{correlativo:a},success:function(b){$("#form_factura input[name=numero_factura]").val(b);
$("#form_agregar_caja_factura input[name=caja_numero]").val(b);}});}function verificarnumeroboleta(){var a=$("#form_boleta input[name=serie]").val();$.ajax({url:"../Listapedidos/verificarnumeroboleta",type:"POST",dataType:"html",data:{correlativo:a},success:function(b){$("#form_boleta input[name=numero_boleta]").val(b);
$("#form_agregar_caja_boleta input[name=caja_numero]").val(b);}});}function tipodecambio(a){var b=$("#form_factura");b.find("input[name=moneda]").val($(a).val());
var c=b.find("input[name=moneda]").val();if(c=="USD"){b.find("input[name=tipocambio]").attr("readonly",false);b.find("input[name=tipocambio]").attr("required",true);
}if(c=="PEN"){b.find("input[name=tipocambio]").attr("readonly",true);b.find("input[name=tipocambio]").attr("required",false);}}function tipodecambio_boleta(a){var b=$("#form_boleta");
b.find("input[name=moneda]").val($(a).val());var c=b.find("input[name=moneda]").val();if(c=="USD"){b.find("input[name=tipocambio]").attr("readonly",false);
b.find("input[name=tipocambio]").attr("required",true);}if(c=="PEN"){b.find("input[name=tipocambio]").attr("readonly",true);b.find("input[name=tipocambio]").attr("required",false);
}}function verificar_sunat_transaccion(a){var c=$("#form_factura");c.find("input[name=sunat_transaccion]").val($(a).val());var b=c.find("input[name=sunat_transaccion]").val();
if(b==1){c.find("select[name=condiciones_pago]").prop("disabled",true);c.find("input[name=guia_serie]").prop("disabled",true);c.find("select[name=condiciones_pago]").attr("required",false);
c.find("input[name=guia_serie]").attr("required",false);}if(b==10){c.find("select[name=condiciones_pago]").prop("disabled",false);c.find("input[name=guia_serie]").prop("disabled",false);
c.find("select[name=condiciones_pago]").attr("required",true);c.find("input[name=guia_serie]").attr("required",true);}}function verificar_sunat_transaccion_boleta(a){var c=$("#form_boleta");
c.find("input[name=sunat_transaccion]").val($(a).val());var b=c.find("input[name=sunat_transaccion]").val();if(b==1){c.find("select[name=condiciones_pago]").prop("disabled",true);
c.find("input[name=guia_serie]").prop("disabled",true);c.find("select[name=condiciones_pago]").attr("required",false);c.find("input[name=guia_serie]").attr("required",false);
}if(b==10){c.find("select[name=condiciones_pago]").prop("disabled",false);c.find("input[name=guia_serie]").prop("disabled",false);c.find("select[name=condiciones_pago]").attr("required",true);
c.find("input[name=guia_serie]").attr("required",true);}}function mediosdepago(a){$("#form_factura input[name=medio_pago]").val($(a).val());}function mediosdepago_boleta(a){$("#form_boleta input[name=medio_pago]").val($(a).val());
}function condicionesdepago(a){$("#form_factura input[name=condiciones_pago]").val($(a).val());}$(function(){$("#form_factura").on("submit",function(g){g.preventDefault();
if($("#form_agregar_caja_factura input[name=total_pago]").val()==""||$("#form_agregar_caja_factura input[name=total_pago]").val()=="0"||$("#form_agregar_caja_factura input[name=total_pago]").val()=="0.00"){$("#form_agregar_caja_factura input[name=total_pago]").val("0");
$("#form_agregar_caja_factura input[name=total_pago]").focus();alertify.notify("Ingrese <strong>monto</strong> recibido","custom-black",4,function(){});
}else{$(".btn_caja_factura").trigger("click");var c=$(this);var b=c.attr("method");var a=c.attr("action");var d=new FormData(this);d.append("dato","valor");
$.ajax({url:a,type:b,dataType:"html",data:d,cache:false,contentType:false,processData:false,beforeSend:function(){alertify.notify(' <img class="loading" src="../public/img/spinner.svg"> Enviando <strong>Factura</strong> a <img class="alertify-sunat" src="../public/img/sunat.png" alt="">',"custom-black",3600,function(){});
},success:function(e){alertify.dismissAll();if(e==0){alertify.notify("<strong>Factura</strong> enviada correctamente","custom-black",5,function(){});alertify.modal_factura().close();
$("#form_factura")[0].reset();table=$(".datatable_lista").DataTable();table.ajax.reload();}},error:function(){},});}});});$(function(){$("#form_boleta").on("submit",function(g){g.preventDefault();
if($("#form_agregar_caja_boleta input[name=total_pago]").val()==""||$("#form_agregar_caja_boleta input[name=total_pago]").val()=="0"||$("#form_agregar_caja_boleta input[name=total_pago]").val()=="0.00"){$("#form_agregar_caja_boleta input[name=total_pago]").val("0");
$("#form_agregar_caja_boleta input[name=total_pago]").focus();alertify.notify("Ingrese <strong>monto</strong> recibido","custom-black",4,function(){});
}else{$(".btn_caja_boleta").trigger("click");var c=$(this);var b=c.attr("method");var a=c.attr("action");var d=new FormData(this);d.append("dato","valor");
$.ajax({url:a,type:b,dataType:"html",data:d,cache:false,contentType:false,processData:false,beforeSend:function(){alertify.notify(' <img class="loading" src="../public/img/spinner.svg"> Enviando <strong>Boleta</strong> a <img class="alertify-sunat" src="../public/img/sunat.png" alt="">',"custom-black",3600,function(){});
},success:function(e){alertify.dismissAll();if(e==0){alertify.notify("<strong>Boleta</strong> enviada correctamente","custom-black",5,function(){});alertify.modal_boleta().close();
$("#form_factura")[0].reset();table=$(".datatable_lista").DataTable();table.ajax.reload();}else{alertify.notify(e,"custom",5,function(){});alertify.modal_boleta().close();
$("#form_boleta")[0].reset();table=$(".datatable_lista").DataTable();table.ajax.reload();}},error:function(){},});}});});function eliminar_pedido(a,b){$.ajax({url:"../Listapedidos/eliminar_pedido",type:"POST",dataType:"html",data:{nropedido:a,usuario:b},success:function(c){table=table=$(".datatable_lista").DataTable();
table.ajax.reload();}});}function tabla_itemspedido_totales_pedidos(c,a,b){$.ajax({url:"../Pedidos/tabla_itemspedido_totales_pedidos/"+c+"/"+a,type:"POST",dataType:"json",success:function(d){b.find(".label_subtotal,.label_igv,.label_total").html("");
b.find(".label_subtotal").html(d[0].subtotal);b.find(".label_igv").html(d[0].igv);b.find(".label_total").html(d[0].total);$("#form_agregar_caja_factura input[name=total_caja]").val(d[0].total);
$("#form_agregar_caja_factura input[name=total_pago]").val(d[0].total);$("#form_agregar_caja_factura input[name=total_pago]").trigger("change");}});}function tabla_itemspedido_totales_pedidos_boleta(c,a,b){$.ajax({url:"../Pedidos/tabla_itemspedido_totales_pedidos/"+c+"/"+a,type:"POST",dataType:"json",success:function(d){b.find(".label_subtotal,.label_igv,.label_total").html("");
b.find(".label_subtotal").html(d[0].subtotal);b.find(".label_igv").html(d[0].igv);b.find(".label_total").html(d[0].total);$("#form_agregar_caja_boleta input[name=total_caja]").val(d[0].total);
$("#form_agregar_caja_boleta input[name=total_pago]").val(d[0].total);$("#form_agregar_caja_boleta input[name=total_pago]").trigger("change");}});}$(function(){$("#form_agregar_caja_boleta").on("submit",function(g){g.preventDefault();
var c=$(this);var b=c.attr("method");var a=c.attr("action");var d=new FormData(this);d.append("dato","valor");$.ajax({url:a,type:b,dataType:"html",data:d,cache:false,contentType:false,processData:false,beforeSend:function(){},success:function(e){},error:function(){},});
});});$(function(){$("#form_agregar_caja_factura").on("submit",function(g){g.preventDefault();var c=$(this);var b=c.attr("method");var a=c.attr("action");
var d=new FormData(this);d.append("dato","valor");$.ajax({url:a,type:b,dataType:"html",data:d,cache:false,contentType:false,processData:false,beforeSend:function(){},success:function(e){},error:function(){},});
});});