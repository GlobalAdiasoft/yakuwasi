$(document).ready(function(){verificarnumerofactura();$(".two-decimals").change(function(){if($(this).val()==""){$(this).val(0);}this.value=parseFloat(this.value).toFixed(2);
});$(".two-decimals2").change(function(){if($(this).val()==""){$(this).val(0);}this.value=parseFloat(this.value).toFixed(3);});$("input[name=preciounitario],input[name=cantidad]").change(function(){var a=$("input[name=cantidad]").val();
var c=$("input[name=preciounitario]").val();var b=a*c;$("input[name=total]").val(parseFloat(b).toFixed(2));});$("input[name=cli_id]").change(function(){llamar_cliente();
});$("select[name=moneda]").change(function(){tipodecambio(this);});$("select[name=condiciones_pago]").change(function(){condicionesdepago(this);});$("select[name=medio_pago]").change(function(){mediosdepago(this);
});$("select[name=sunat_transaccion]").change(function(){verificar_sunat_transaccion(this);});$(".modal_agregar_cliente").hm_modal("init",{backgroundcolorhead:"#1B3156",colorhead:"white",colorfooter:"rgba(0,0,0,0.4)",padding:5,sombra:true,width:"auto",nivelfade:9,});
mostrar_ubigeo();llamar_rucs();llamar_codpro();$("#form_agregar_factura select[name=correlativo]").change(function(){verificarnumerofactura();});$("input[name=codproducto]").change(function(){cod_producto($(this).val());
});});function convertir_decimales(){$(".two-decimals").val(0);$(".two-decimals").val(parseFloat($(".two-decimals").val()).toFixed(2));}function llamar_cliente(){var a=$("input[name=cli_id]").val();
$.ajax({url:"../Clientes/llamar_cliente",type:"POST",dataType:"html",data:{id:a,},success:function(b){if(b=="vacio"){$("#cli_nombre").text("NO SE ENCONTRARON RESULTADOS").css({color:"red",});
$("#cli_ruc").text(" ");$("#cli_ubigeo").text(" ");$("#cli_direccion").text(" ");$("#cli_telefono").text(" ");$("#cli_celular").text(" ");}else{var c=JSON.parse(b);
$("#cli_nombre").css({color:"#1B3156",});$("#cli_nombre").text(c[0].cli_nombre);$("#cli_ruc").text(c[0].cli_ruc);$("#cli_ubigeo").text(c[0].cli_ubigeo);
$("#cli_direccion").text(c[0].cli_direccion);$("#cli_telefono").text(c[0].cli_telefono);$("#cli_celular").text(c[0].cli_celular);}}});}$(function(){$("#form_agregar_factura").on("submit",function(g){g.preventDefault();
var c=$(this);var b=c.attr("method");var a=c.attr("action");var d=new FormData(this);d.append("dato","valor");$("select[name=moneda]").prop("disabled","disabled");
$("input[name=tipocambio]").prop("readonly",true);$("input[name=guia_serie]").prop("readonly",true);$("select[name=sunat_transaccion]").prop("disabled",true);
$("select[name=medio_pago]").prop("disabled",true);$("select[name=condiciones_pago]").prop("disabled",true);if($("#cli_nombre").text()=="NO SE ENCONTRARON RESULTADOS"){$("input[name=cli_id]").focus();
return;}else{$.ajax({url:a,type:b,dataType:"html",data:d,cache:false,contentType:false,processData:false,beforeSend:function(){},success:function(f){if(f==1){var e=$("#form_agregar_factura input[name=codproducto]").val();
alertify.notify("No cuenta con stock suficiente del producto <strong>"+e+"</strong>","custom",5,function(){});$("#form_agregar_factura input[name=cantidad]").focus();
}else{$("input[name=numero_factura]").prop("readonly",true);$("input[name=cli_id]").prop("readonly",true);$("input[name=cantidad]").val("");$("input[name=codproducto]").val("");
$("input[name=producto]").val("");$("input[name=preciounitario]").val("");$("input[name=total]").val("");$("select[name=moneda]").prop("readonly",true);
$("input[name=cantidad]").focus();tabla_itemsfactura();}if(f==2){var e=$("#form_agregar_factura input[name=codproducto]").val();alertify.notify("Stock m√≠nimo del producto <strong>"+e+"</strong>","custom",5,function(){});
}},error:function(){},});}});});function tabla_itemsfactura(){var b=$("select[name=correlativo]").val();var a=$("input[name=numero_factura]").val();$.ajax({url:"../Facturas/tabla_itemsfactura",type:"POST",dataType:"html",data:{correlativo:b,numero_factura:a},success:function(c){$("#tabla_itemsfactura").html(c);
$(".eliminaritem").click(function(){eliminar_itemfactura($(this).val());});}});}function eliminar_itemfactura(a){$.ajax({url:"../Facturas/eliminar_itemfactura",type:"POST",dataType:"html",data:{id:a,},success:function(b){tabla_itemsfactura();
}});}function mostrar_ubigeo(){$.ajax({url:"../Clientes/mostrar_ubigeo2",type:"POST",dataType:"html",success:function(a){$("select[name = ubigeo]").append(a);
}});}$(function(){$("#form_agregar_cliente").on("submit",function(g){g.preventDefault();var c=$(this);var b=c.attr("method");var a=c.attr("action");var d=new FormData(this);
d.append("dato","valor");$.ajax({url:a,type:b,dataType:"html",data:d,cache:false,contentType:false,processData:false,beforeSend:function(){},success:function(e){$(".modal_agregar_cliente").hm_modal("hide",{backgroundcolorhead:"#1B3156",colorhead:"white",colorfooter:"rgba(0,0,0,0.4)",padding:5,sombra:true,width:"auto",nivelfade:9,});
llamar_rucs();c[0].reset();},error:function(){},});});});function llamar_rucs(){$.ajax({url:"../Clientes/llamar_rucs",type:"POST",dataType:"html",success:function(a){$("#datalist_rucs").html(a);
}});}function llamar_codpro(){$.ajax({url:"../Articulos/llamar_codpro",type:"POST",dataType:"html",success:function(a){$("#datalist_codpro").html(a);}});
}function tipodecambio(a){$("input[name=moneda]").val($(a).val());var b=$("input[name=moneda]").val();if(b==2){$("input[name=tipocambio]").attr("readonly",false);
$("input[name=tipocambio]").attr("required",true);}if(b==1){$("input[name=tipocambio]").attr("readonly",true);$("input[name=tipocambio]").attr("required",false);
}}function verificarnumerofactura(){var a=$("#form_agregar_factura select[name=correlativo]").val();$.ajax({url:"../Facturas/verificarnumerofactura",type:"POST",dataType:"html",data:{correlativo:a},success:function(b){$("input[name=numero_factura]").val(b);
}});}function verificar_sunat_transaccion(a){$("input[name=sunat_transaccion]").val($(a).val());var b=$("input[name=sunat_transaccion]").val();if(b==1){$("select[name=condiciones_pago]").prop("disabled",true);
$("input[name=guia_serie]").prop("disabled",true);$("select[name=condiciones_pago]").attr("required",false);$("input[name=guia_serie]").attr("required",false);
}if(b==10){$("select[name=condiciones_pago]").prop("disabled",false);$("input[name=guia_serie]").prop("disabled",false);$("select[name=condiciones_pago]").attr("required",true);
$("input[name=guia_serie]").attr("required",true);}}function condicionesdepago(a){$("input[name=condiciones_pago]").val($(a).val());}function mediosdepago(a){$("input[name=medio_pago]").val($(a).val());
}function cod_producto(a){var c=a;var b=c.split("-");var a=b[0];console.log(b[0]);$.ajax({url:"../Factura/codpro",type:"POST",dataType:"html",data:{codart:a,},success:function(f){console.log(f);
if(f==0){$("input[name=producto]").val("");$("input[name=preciounitario]").val("");$("input[name=total]").val("");}else{$("input[name=producto]").val(f[0].art_nombre);
$("input[name=preciounitario]").val(f[0].art_preciotienda);$("input[name=id]").val(f[0].id);var d=$("input[name=cantidad]").val();var g=$("input[name=preciounitario]").val();
var e=d*g;$("input[name=total]").val(parseFloat(e).toFixed(2));}}});}